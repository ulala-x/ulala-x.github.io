<?xml version="1.0" encoding="utf-8"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <PropertyGroup>
    <!-- Detect architecture -->
    <NetZmqArch Condition="'$(NetZmqArch)' == ''">$([System.Runtime.InteropServices.RuntimeInformation]::ProcessArchitecture)</NetZmqArch>

    <!-- Define native library names per platform -->
    <NetZmqNativeLibName Condition="$([MSBuild]::IsOSPlatform('Windows'))">libzmq.dll</NetZmqNativeLibName>
    <NetZmqNativeLibName Condition="$([MSBuild]::IsOSPlatform('Linux'))">libzmq.so</NetZmqNativeLibName>
    <NetZmqNativeLibName Condition="$([MSBuild]::IsOSPlatform('OSX'))">libzmq.dylib</NetZmqNativeLibName>
  </PropertyGroup>

  <!-- Windows x64 -->
  <ItemGroup Condition="'$(RuntimeIdentifier)' == 'win-x64' or ('$(RuntimeIdentifier)' == '' and $([MSBuild]::IsOSPlatform('Windows')) and '$(NetZmqArch)' == 'X64')">
    <None Include="$(MSBuildThisFileDirectory)..\runtimes\win-x64\native\libzmq.dll">
      <Link>%(Filename)%(Extension)</Link>
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <Visible>false</Visible>
    </None>
    <Content Include="$(MSBuildThisFileDirectory)..\runtimes\win-x64\native\libzmq.dll">
      <Link>%(Filename)%(Extension)</Link>
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <Visible>false</Visible>
    </Content>
  </ItemGroup>

  <!-- Windows ARM64 -->
  <ItemGroup Condition="'$(RuntimeIdentifier)' == 'win-arm64' or ('$(RuntimeIdentifier)' == '' and $([MSBuild]::IsOSPlatform('Windows')) and '$(NetZmqArch)' == 'Arm64')">
    <None Include="$(MSBuildThisFileDirectory)..\runtimes\win-arm64\native\libzmq.dll">
      <Link>%(Filename)%(Extension)</Link>
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <Visible>false</Visible>
    </None>
    <Content Include="$(MSBuildThisFileDirectory)..\runtimes\win-arm64\native\libzmq.dll">
      <Link>%(Filename)%(Extension)</Link>
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <Visible>false</Visible>
    </Content>
  </ItemGroup>

  <!-- Linux x64 -->
  <ItemGroup Condition="'$(RuntimeIdentifier)' == 'linux-x64' or ('$(RuntimeIdentifier)' == '' and $([MSBuild]::IsOSPlatform('Linux')) and '$(NetZmqArch)' == 'X64')">
    <None Include="$(MSBuildThisFileDirectory)..\runtimes\linux-x64\native\libzmq.so">
      <Link>%(Filename)%(Extension)</Link>
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <Visible>false</Visible>
    </None>
    <Content Include="$(MSBuildThisFileDirectory)..\runtimes\linux-x64\native\libzmq.so">
      <Link>%(Filename)%(Extension)</Link>
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <Visible>false</Visible>
    </Content>
  </ItemGroup>

  <!-- Linux ARM64 -->
  <ItemGroup Condition="'$(RuntimeIdentifier)' == 'linux-arm64' or ('$(RuntimeIdentifier)' == '' and $([MSBuild]::IsOSPlatform('Linux')) and '$(NetZmqArch)' == 'Arm64')">
    <None Include="$(MSBuildThisFileDirectory)..\runtimes\linux-arm64\native\libzmq.so">
      <Link>%(Filename)%(Extension)</Link>
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <Visible>false</Visible>
    </None>
    <Content Include="$(MSBuildThisFileDirectory)..\runtimes\linux-arm64\native\libzmq.so">
      <Link>%(Filename)%(Extension)</Link>
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <Visible>false</Visible>
    </Content>
  </ItemGroup>

  <!-- macOS x64 -->
  <ItemGroup Condition="'$(RuntimeIdentifier)' == 'osx-x64' or ('$(RuntimeIdentifier)' == '' and $([MSBuild]::IsOSPlatform('OSX')) and '$(NetZmqArch)' == 'X64')">
    <None Include="$(MSBuildThisFileDirectory)..\runtimes\osx-x64\native\libzmq.dylib">
      <Link>%(Filename)%(Extension)</Link>
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <Visible>false</Visible>
    </None>
    <Content Include="$(MSBuildThisFileDirectory)..\runtimes\osx-x64\native\libzmq.dylib">
      <Link>%(Filename)%(Extension)</Link>
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <Visible>false</Visible>
    </Content>
  </ItemGroup>

  <!-- macOS ARM64 -->
  <ItemGroup Condition="'$(RuntimeIdentifier)' == 'osx-arm64' or ('$(RuntimeIdentifier)' == '' and $([MSBuild]::IsOSPlatform('OSX')) and '$(NetZmqArch)' == 'Arm64')">
    <None Include="$(MSBuildThisFileDirectory)..\runtimes\osx-arm64\native\libzmq.dylib">
      <Link>%(Filename)%(Extension)</Link>
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <Visible>false</Visible>
    </None>
    <Content Include="$(MSBuildThisFileDirectory)..\runtimes\osx-arm64\native\libzmq.dylib">
      <Link>%(Filename)%(Extension)</Link>
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <Visible>false</Visible>
    </Content>
  </ItemGroup>

  <!-- Diagnostic information -->
  <Target Name="NetZmqNativeInfo" BeforeTargets="Build">
    <Message Text="Net.Zmq.Native: RuntimeIdentifier = $(RuntimeIdentifier)" Importance="high" />
    <Message Text="Net.Zmq.Native: Architecture = $(NetZmqArch)" Importance="high" />
    <Message Text="Net.Zmq.Native: Native library = $(NetZmqNativeLibName)" Importance="high" />
  </Target>

</Project>
