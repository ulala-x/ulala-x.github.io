---
import { getCollection } from "astro:content";
import { slugifyStr } from "@/utils/slugify";

export async function getStaticPaths() {
  const posts = await getCollection("blog", ({ data }) => !data.draft && data.lang === "ko");

  const tags = new Set<string>();
  posts.forEach(post => {
    post.data.tags.forEach(tag => tags.add(slugifyStr(tag.toLowerCase())));
  });

  return Array.from(tags).map(tag => ({
    params: { tag, page: undefined },
    props: { tag },
  }));
}

const { tag } = Astro.props;
const redirectUrl = `/ko/tags/${tag}`;
---

<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="refresh" content="0; url={redirectUrl}" />
    <link rel="canonical" href={redirectUrl} />
    <title>Redirecting...</title>
  </head>
  <body>
    <p>Redirecting to <a href={redirectUrl}>{redirectUrl}</a>...</p>
  </body>
</html>
